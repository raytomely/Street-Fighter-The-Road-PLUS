/* MIDI FILE FORMAT HEADER FILE */

#define MAX_TRACK 16 /* 최대 미디 트랙 갯수 */

#define MIDI_NOTE_OFF      0x80
#define MIDI_NOTE_ON       0x90
#define MIDI_KEY_VELO      0xA0
#define MIDI_CONTROL_CHG   0xB0
#define MIDI_PROGRAM_CHG   0xC0
#define MIDI_CHANNEL_VELO  0xD0
#define MIDI_VENDOR_UNIQ   0xE0
#define MIDI_EXCLUSIVE     0xF0
#define META_MESSAGE       0xFF
#define META_END_OF_TRACK  0x2F
#define META_CHANGE_TEMPO  0x51

typedef struct
{
   unsigned char *ptr ; /* 트랙 연주 포인터 */
   unsigned char message ; /* 현재 메세지 */
   unsigned char status  ; /* 트랙 상태 */
   int size ;             /* 트랙 길이 */
   int timeStamp ;        /* 트랙 연주 타임 */
} _MIDITRACK_ ; /* 미디 1 트랙 스트럭쳐 */

typedef struct
{
   unsigned char *ptr ;
   int  tickPerQNote  ; /* 1/4박자당 타이머 틱수 */
   int  uSecPerQNote           ; /* 1/4박자당 걸리는 시간 micro Second */
   int  currentTime            ; /* 현재 시간 */
   int  willPlayTime           ; /* 다음에 연주할 시간 */
   int  willPlayTrack          ; /* 다음에 연주할 트랙 번호 */
   int  timer0Divisor         ; /* 8254 타이머 채널 0 분주값 */
   int  numOfTrack    ; /* 사용된 트랙 갯수 */
   unsigned char allTrackEnd   ; /* 모든 트랙의 연주종료시 1 */
} _MIDIPLAY_ ; /* 미디 연주 스트럭쳐 */

int playMidiData( char *fn, unsigned int size );
void midiTickEvent(void) ;
void endMidiPlay(void) ;
int setUpMidiTrack(unsigned char *midiPtr,_MIDITRACK_ MT[],_MIDIPLAY_ *MP) ;
int is4CharCmp(unsigned char *name1,unsigned char *name2) ;
int get4Byte(unsigned char *ptr) ;
int get2Byte(unsigned char *ptr) ;
int getMidiLength(unsigned char **ptr) ;
void playTrack(_MIDITRACK_ MT[],_MIDIPLAY_ *MP) ;
void calcWillPlayTrack(_MIDITRACK_ MT[],_MIDIPLAY_ *MP) ;
void sendMessage(unsigned char message,_MIDITRACK_ *MT) ;
void setMidiTempo(int uSecPerQNote) ;
void setRelativeMusicTempo(int divisor) ;
void setMidiPlaySpeed(int speed) ;
void setTimer0(int divisor) ;
void setMidiMainVolume(int volume) ;


#ifndef _MIDI_MAIN_SOURCE_
extern int playMidiLoopCounter ; /* 반복 연주 횟수 */
extern int flagMidiPlay ;        /* 음악 연주중 상태 프래그 */
extern int speedMidiPlay ;       /* 음악 연주 속도 */
extern int midiMainVolume ;      /* 음악 소리 볼륨 */
#endif

/*
   MPU 401 Midi Interface Program Header File
*/

#ifndef _MPU401_IO_
#define _MPU401_IO_

int sendMPU401Command(unsigned char cmd) ; /* MPU 401 젌쮩 첲쩉 */
int sendMPU401Data(unsigned char data) ; /* MPU 401 온첇콪 첲쩉 */
int initMPU401(int BaseIO) ; /* MPU 401 퉘邱 */
int autoDetectMPU401(void) ; /* MPU 401 첔 칲콜 */
int sendMidiData(int cmd1,int data1,int data2) ; /* 좗왫 Ъ쨰 첲쩉 */

#endif

#ifndef _MPU401_IO_MAIN_
extern int MPU401BaseIO ; /* MPU 401 줚첇쫔 I/O 좾쵔 */
#endif
